/*
* maskMoney plugin for jQuery
* http://plentz.github.com/jquery-maskmoney/
* version: 2.0.1
* Licensed under the MIT license
*/
!function(e){e.browser||(e.browser={},e.browser.mozilla=/mozilla/.test(navigator.userAgent.toLowerCase())&&!/webkit/.test(navigator.userAgent.toLowerCase()),e.browser.webkit=/webkit/.test(navigator.userAgent.toLowerCase()),e.browser.opera=/opera/.test(navigator.userAgent.toLowerCase()),e.browser.msie=/msie/.test(navigator.userAgent.toLowerCase()));var t={destroy:function(){return e(this).unbind(".maskMoney"),e.browser.msie?this.onpaste=null:e.browser.mozilla&&this.removeEventListener("input",blurEvent,!1),this},mask:function(){return this.trigger("mask")},init:function(t){return t=e.extend({symbol:"US$",showSymbol:!1,symbolStay:!1,thousands:",",decimal:".",precision:2,defaultZero:!0,allowZero:!1,allowNegative:!1},t),this.each(function(){var a=e(this),r=!1;function n(){r=!0}function o(){r=!1}function l(l){var u=(l=l||window.event).which||l.charCode||l.keyCode;if(null==u)return!1;if(u<48||u>57)return 45==u?(n(),a.val(function(e){if(t.allowNegative){e.val();return""!=e.val()&&"-"==e.val().charAt(0)?e.val().replace("-",""):"-"+e.val()}return e.val()}(a)),!1):43==u?(n(),a.val(a.val().replace("-","")),!1):13==u||9==u?(r&&(o(),e(this).change()),!0):!(!e.browser.mozilla||37!=u&&39!=u||0!=l.charCode)||(s(l),!0);if(a.val().length>=a.attr("maxlength"))return!1;s(l);var c=String.fromCharCode(u),v=a.get(0),h=g(v),b=h.start,m=h.end;return v.value=v.value.substring(0,b)+c+v.value.substring(m,v.value.length),i(v,b+1),n(),!1}function s(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function i(t,r){var n=a.val().length;a.val(u(t.value));var o=a.val().length;!function(t,a){e(t).each(function(e,t){if(t.setSelectionRange)t.focus(),t.setSelectionRange(a,a);else if(t.createTextRange){var r=t.createTextRange();r.collapse(!0),r.moveEnd("character",a),r.moveStart("character",a),r.select()}})}(a,r-=n-o)}function u(e){var a=(e=e.replace(t.symbol,"")).length,r="",n="",o="";if(0!=a&&"-"==e.charAt(0)&&(e=e.replace("-",""),t.allowNegative&&(o="-")),0==a){if(!t.defaultZero)return n;n="0.00"}for(var l=0;l<a&&("0"==e.charAt(l)||e.charAt(l)==t.decimal);l++);for(;l<a;l++)-1!="0123456789".indexOf(e.charAt(l))&&(r+=e.charAt(l));var s=parseFloat(r);n=(s=isNaN(s)?0:s/Math.pow(10,t.precision)).toFixed(t.precision),l=0==t.precision?0:1;var i,u=(n=n.split("."))[l].substr(0,t.precision);for(i=(n=n[0]).length;(i-=3)>=1;)n=n.substr(0,i)+t.thousands+n.substr(i);return t.precision>0?v(o+n+t.decimal+u+Array(t.precision+1-u.length).join(0)):v(o+n)}function c(){return(parseFloat("0")/Math.pow(10,t.precision)).toFixed(t.precision).replace(new RegExp("\\.","g"),t.decimal)}function v(e){if(t.showSymbol){var a="";0!=e.length&&"-"==e.charAt(0)&&(e=e.replace("-",""),a="-"),e.substr(0,t.symbol.length)!=t.symbol&&(e=a+t.symbol+e)}return e}function g(e){var t,a,r,n,o,l=0,s=0;return"number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd?(l=e.selectionStart,s=e.selectionEnd):(a=document.selection.createRange())&&a.parentElement()==e&&(n=e.value.length,t=e.value.replace(/\r\n/g,"\n"),(r=e.createTextRange()).moveToBookmark(a.getBookmark()),(o=e.createTextRange()).collapse(!1),r.compareEndPoints("StartToEnd",o)>-1?l=s=n:(l=-r.moveStart("character",-n),l+=t.slice(0,l).split("\n").length-1,r.compareEndPoints("EndToEnd",o)>-1?s=n:(s=-r.moveEnd("character",-n),s+=t.slice(0,s).split("\n").length-1))),{start:l,end:s}}a.attr("readonly")||(a.unbind(".maskMoney"),a.bind("keypress.maskMoney",l),a.bind("keydown.maskMoney",function(t){var l=(t=t||window.event).which||t.charCode||t.keyCode;if(null==l)return!1;var u=a.get(0),c=g(u),v=c.start,h=c.end;return 8==l?(s(t),v==h?(u.value=u.value.substring(0,v-1)+u.value.substring(h,u.value.length),v-=1):u.value=u.value.substring(0,v)+u.value.substring(h,u.value.length),i(u,v),n(),!1):9==l?(r&&(e(this).change(),o()),!0):46!=l&&63272!=l||(s(t),u.selectionStart==u.selectionEnd?u.value=u.value.substring(0,v)+u.value.substring(h+1,u.value.length):u.value=u.value.substring(0,v)+u.value.substring(h,u.value.length),i(u,v),n(),!1)}),a.bind("blur.maskMoney",function(r){e.browser.msie&&l(r),""==a.val()||a.val()==v(c())||a.val()==t.symbol?t.allowZero?t.symbolStay?a.val(v(c())):a.val(c()):a.val(""):t.symbolStay?t.symbolStay&&a.val()==t.symbol&&a.val(v(c())):a.val(a.val().replace(t.symbol,""))}),a.bind("focus.maskMoney",function(e){var r=c();if(a.val()==r?a.val(""):""==a.val()&&t.defaultZero?a.val(v(r)):a.val(v(a.val())),this.createTextRange){var n=this.createTextRange();n.collapse(!1),n.select()}}),a.bind("mask.maskMoney",function(){var e=a.val();a.val(u(e))}))})}};e.fn.maskMoney=function(a){return t[a]?t[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a?void e.error("Method "+a+" does not exist on jQuery.tooltip"):t.init.apply(this,arguments)}}(jQuery);